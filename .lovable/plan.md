
# ุฎุทุฉ ุดุงููุฉ ูุชุญุณูู ุงููุธุงู

## ููุฎุต ุงูููุงู ุงููุทููุจุฉ

1. **ุงูุชุญูู ูู API ูุงุฎุชุจุงุฑู**: ุฅุถุงูุฉ ุฃุฏุงุฉ ุงุฎุชุจุงุฑ API ูู ุงููุงุฌูุฉ
2. **Google OAuth ูู YouTube**: ุชุทุจูู ูุตุงุฏูุฉ Google OAuth 2.0 ูุงููุฉ
3. **ุงูุชุญูู ูู Instagram/Facebook**: ุงูุชุญูู ูู ุตุญุฉ ุงูุฑููุฒ ูุนุฑุถ ุงูุญุณุงุจุงุช ุงููุฑุจูุทุฉ
4. **ุงูุชุญูู ูู Telegram ู ElevenLabs**: ุงูุชุญูู ูู ุตุญุฉ ุงูุฅุนุฏุงุฏุงุช
5. **ูุดุฑ ุจูุณุช ุชุฃููุฏู**: ุฅููุงููุฉ ูุดุฑ ุจูุณุช ุชุฌุฑูุจู ุนูู ุงูููุตุงุช ุงููุฑุจูุทุฉ
6. **ุงููุดุฑ ุงูุชููุงุฆู**: ูุดุฑ ุงูููุฏูู ุชููุงุฆูุงู ุจุนุฏ ุงูุฅูุดุงุก
7. **ูุฑุงุฌุนุฉ ุดุงููุฉ ูููุธุงู**: ุฅุตูุงุญ ุงูุฃุฎุทุงุก ูุงููุดุงูู ุงูุฃูููุฉ

---

## ุงููุฑุญูุฉ ุงูุฃููู: ูุตุงุฏูุฉ Google OAuth ูู YouTube

### 1.1 Edge Function ุฌุฏูุฏ: `google-auth`

ุณูุชู ุฅูุดุงุก Edge Function ูุชูููุฐ ุชุฏูู OAuth 2.0:

```text
/google-auth
  โโโ GET ?action=auth_url    โ ููุฑุฌุน ุฑุงุจุท ุงููุตุงุฏูุฉ
  โโโ POST { code }           โ ูุณุชุจุฏู ุงูููุฏ ุจู access_token ู refresh_token
```

### 1.2 ุตูุญุฉ Callback ุฌุฏูุฏุฉ

- `/auth/callback` - ุชุณุชูุจู ุงูููุฏ ูู Google ูุชุญูุธ ุงูุฑููุฒ

### 1.3 ุชุญุฏูุซ OAuthSettings.tsx

- ุฅุถุงูุฉ ุฒุฑ "Connect with Google" ููุชุญ ูุงูุฐุฉ ูุตุงุฏูุฉ OAuth
- ุจุนุฏ ูุฌุงุญ ุงููุตุงุฏูุฉุ ูุชู ุญูุธ ุงูุฑููุฒ ูู ุฌุฏูู `oauth_tokens`

---

## ุงููุฑุญูุฉ ุงูุซุงููุฉ: ุงูุชุญูู ูู ุงูุฑููุฒ ูุนุฑุถ ุงูุญุณุงุจุงุช

### 2.1 Edge Function ุฌุฏูุฏ: `verify-tokens`

```text
/verify-tokens
  POST { platform: 'youtube' | 'instagram' | 'facebook' | 'telegram' | 'elevenlabs' }
  
  Response:
  {
    valid: boolean,
    account_info: {
      name: string,
      id: string,
      picture?: string,
      pages?: Array<{ id, name }>,  // ููููุณุจูู
      channel?: { id, title }       // ููููุชููุจ
    },
    error?: string
  }
```

### 2.2 API ุงูุชุญูู ููู ููุตุฉ

| ุงูููุตุฉ | ุทุฑููุฉ ุงูุชุญูู |
|--------|-------------|
| YouTube | `GET https://www.googleapis.com/youtube/v3/channels?part=snippet&mine=true` |
| Instagram | `GET https://graph.facebook.com/me?fields=id,username,name` |
| Facebook | `GET https://graph.facebook.com/me/accounts?fields=id,name,access_token` |
| Telegram | ุงุฎุชุจุงุฑ ุฅุฑุณุงู `getMe` API |
| ElevenLabs | `GET https://api.elevenlabs.io/v1/user` |

### 2.3 ุชุญุฏูุซ ูุงุฌูุฉ ุงูุฅุนุฏุงุฏุงุช

- ุนุฑุถ ูุนูููุงุช ุงูุญุณุงุจ ุงููุฑุจูุท (ุงูุงุณูุ ุงูุตูุฑุฉุ ID)
- ุนุฑุถ ุงูุตูุญุงุช ุงููุฑุจูุทุฉ ููููุณุจูู
- ุนุฑุถ ุงุณู ุงูููุงุฉ ููููุชููุจ
- ูุคุดุฑ ุญุงูุฉ ุงูุงุชุตุงู (ูุชุตู/ุบูุฑ ูุชุตู/ููุชูู ุงูุตูุงุญูุฉ)

---

## ุงููุฑุญูุฉ ุงูุซุงูุซุฉ: ูุดุฑ ุจูุณุช ุชุฃููุฏู

### 3.1 Edge Function ุฌุฏูุฏ: `test-publish`

```text
/test-publish
  POST {
    platform: 'youtube' | 'instagram' | 'facebook',
    type: 'text' | 'image',
    content: string
  }
  
  Response:
  {
    success: boolean,
    post_url?: string,
    error?: string
  }
```

### 3.2 ุฃููุงุน ุงูุจูุณุช ุงูุชุฌุฑูุจู

| ุงูููุตุฉ | ููุน ุงูุจูุณุช |
|--------|-----------|
| Facebook | ููุดูุฑ ูุตู ุนูู ุงูุตูุญุฉ |
| Instagram | Story ุจูุต (ูุชุทูุจ ุตูุฑุฉ) |
| YouTube | Community Post (ุฅุฐุง ูุงูุช ุงูููุงุฉ ูุคููุฉ) |

### 3.3 ุฒุฑ ูู ุงููุงุฌูุฉ

- "Test Connection" ุจุฌุงูุจ ูู ููุตุฉ ูุฑุจูุทุฉ
- ูุธูุฑ ูุชูุฌุฉ ุงูุงุฎุชุจุงุฑ (ูุฌุงุญ/ูุดู ูุน ุฑุงุจุท ุงูููุดูุฑ)

---

## ุงููุฑุญูุฉ ุงูุฑุงุจุนุฉ: ุงุฎุชุจุงุฑ API ุงูุฎุงุฑุฌู

### 4.1 ุฃุฏุงุฉ ุงุฎุชุจุงุฑ API ูู ุงููุงุฌูุฉ

```text
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐งช API Testing                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  Endpoint: POST /functions/v1/merge-media                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ API Key: [vap_xxxxx...          ]  [Select Key โผ]      โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                             โ
โ  Request Body:                                              โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ {                                                      โ โ
โ  โ   "images": ["https://example.com/img1.jpg"],          โ โ
โ  โ   "audio": "https://example.com/audio.mp3"             โ โ
โ  โ }                                                      โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                              [Test API]     โ
โ                                                             โ
โ  Response:                                                  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ Status: 200 OK โ                                       โ โ
โ  โ { "job_id": "abc123", "status": "processing" }         โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ุงููุฑุญูุฉ ุงูุฎุงูุณุฉ: ุงููุดุฑ ุงูุชููุงุฆู ุจุนุฏ ุงูุฅูุดุงุก

### 5.1 ุชุญุฏูุซ ai-generate

ุจุนุฏ ุงูุชูุงุก ุฏูุฌ ุงูููุฏูู ุจูุฌุงุญ:

```text
1. ุงูุชุญูู ูู ุงูููุตุงุช ุงููุฑุจูุทุฉ ูู oauth_tokens
2. ููู ููุตุฉ ูุฑุจูุทุฉ ููุดุทุฉ:
   - ุงุณุชุฏุนุงุก publish-video function
   - ุชุณุฌูู ุงููุชูุฌุฉ ูู job_steps
3. ุฅุฑุณุงู ุฅุดุนุงุฑ Telegram ุจุฑูุงุจุท ุงููุดุฑ
```

### 5.2 ุชุญุฏูุซ publish-video

- ุงุณุชุฎุฏุงู oauth_tokens ุจุฏูุงู ูู settings ููุฑููุฒ
- ุฅุถุงูุฉ ุฏุนู ุชุญุฏูุซ refresh_token ุนูุฏ ุงูุชูุงุก ุงูุตูุงุญูุฉ

---

## ุงููุฑุญูุฉ ุงูุณุงุฏุณุฉ: ุฅุตูุงุญ ุงููุดุงูู ุงูุจุฑูุฌูุฉ

### 6.1 ุงููุดุงูู ุงูููุชุดูุฉ ูู ุงูููุฏ

| ุงููุดููุฉ | ุงูููู | ุงูุญู |
|---------|------|------|
| `publish-video` ูุณุชุฎุฏู `settings` ุจุฏูุงู ูู `oauth_tokens` | publish-video/index.ts | ุชุญุฏูุซ ููุงุณุชุฎุฏุงู ูู oauth_tokens |
| ูุง ููุฌุฏ ุชุญูู ูู ุตูุงุญูุฉ ุงูุฑููุฒ ูุจู ุงููุดุฑ | publish-video/index.ts | ุฅุถุงูุฉ ุงูุชุญูู ูุชุญุฏูุซ ุงูุฑููุฒ |
| corsHeaders ูุง ูุชุถูู X-API-Key | _shared/supabase.ts | ุฅุถุงูุฉ ุงูููุฏุฑ |
| ูุง ููุฌุฏ rate limiting ููู API | merge-media/index.ts | ุงุฎุชูุงุฑู - ูููู ุฅุถุงูุชู ูุงุญูุงู |

### 6.2 ุชุญุณูู ุงูุฃูุงู

| ุงูุชุญุณูู | ุงููุตู |
|---------|------|
| ุฅุถุงูุฉ X-API-Key ููู CORS headers | ุงูุณูุงุญ ุจุงูููุฏุฑ ูู ุงููุชุตูุญ |
| ุงูุชุญูู ูู ุตุญุฉ URLs ุงููุฏุฎูุฉ | ููุน injection attacks |
| ุชุดููุฑ ุงูุฑููุฒ ุงูุญุณุงุณุฉ | ุชุฎุฒูู ุขูู (ูุชู ุชููุงุฆูุงู ุจูุงุณุทุฉ Supabase) |

---

## ุงููุฑุญูุฉ ุงูุณุงุจุนุฉ: ุงูุชุญูู ูู Telegram ู ElevenLabs

### 7.1 ุชุญุฏูุซ TelegramSettings.tsx

- ุฒุฑ "Verify Token" ููุชุญูู ูู ุตุญุฉ ุงูุฑูุฒ
- ุนุฑุถ ุงุณู ุงูุจูุช ููุนุฑูู ุนูุฏ ูุฌุงุญ ุงูุชุญูู
- ุนุฑุถ Webhook URL ููุฅุนุฏุงุฏ

### 7.2 ุชุญุฏูุซ ElevenLabsKeys.tsx

- ุฒุฑ "Verify" ููู ููุชุงุญ
- ุนุฑุถ ุงูุฑุตูุฏ ุงููุชุจูู ููุนูููุงุช ุงูุญุณุงุจ
- ูุคุดุฑ ุญุงูุฉ ูู ููุชุงุญ

---

## ุงููููุงุช ุงูุฌุฏูุฏุฉ ูุงููุนุฏูุฉ

### ูููุงุช ุฌุฏูุฏุฉ:

| ุงูููู | ุงููุตู |
|------|------|
| `supabase/functions/google-auth/index.ts` | OAuth flow ูู YouTube |
| `supabase/functions/verify-tokens/index.ts` | ุงูุชุญูู ูู ุฌููุน ุงูุฑููุฒ |
| `supabase/functions/test-publish/index.ts` | ูุดุฑ ุจูุณุช ุชุฌุฑูุจู |
| `src/pages/AuthCallback.tsx` | ุงุณุชูุจุงู OAuth callback |
| `src/components/settings/ApiTester.tsx` | ุฃุฏุงุฉ ุงุฎุชุจุงุฑ API |
| `src/components/settings/AccountInfo.tsx` | ุนุฑุถ ูุนูููุงุช ุงูุญุณุงุจ ุงููุฑุจูุท |

### ูููุงุช ูุนุฏูุฉ:

| ุงูููู | ุงูุชุนุฏููุงุช |
|------|----------|
| `src/App.tsx` | ุฅุถุงูุฉ route ููู callback |
| `src/components/settings/OAuthSettings.tsx` | OAuth flow + ุงูุชุญูู + ุนุฑุถ ุงูุญุณุงุจุงุช |
| `src/components/settings/TelegramSettings.tsx` | ุฒุฑ ุงูุชุญูู + ุนุฑุถ ูุนูููุงุช ุงูุจูุช |
| `src/components/settings/ElevenLabsKeys.tsx` | ุฒุฑ ุงูุชุญูู + ุนุฑุถ ุงูุฑุตูุฏ |
| `supabase/functions/publish-video/index.ts` | ุงุณุชุฎุฏุงู oauth_tokens + ุชุญุฏูุซ refresh |
| `supabase/functions/ai-generate/index.ts` | ุงููุดุฑ ุงูุชููุงุฆู ุจุนุฏ ุงูุฅูุดุงุก |
| `supabase/functions/_shared/supabase.ts` | ุฅุถุงูุฉ X-API-Key ููู CORS |
| `supabase/config.toml` | ุฅุนุฏุงุฏ ุงูู Edge Functions ุงูุฌุฏูุฏุฉ |

---

## ููููุฉ ุงุฎุชุจุงุฑ API

### ุจุงุณุชุฎุฏุงู cURL:

```bash
curl -X POST \
  https://cidxcujlfkrzvvmljxqs.supabase.co/functions/v1/merge-media \
  -H "Content-Type: application/json" \
  -H "X-API-Key: vap_YOUR_KEY_HERE" \
  -d '{
    "images": ["https://example.com/image1.jpg", "https://example.com/image2.jpg"],
    "audio": "https://example.com/audio.mp3",
    "callback_url": "https://your-site.com/webhook"
  }'
```

### ุงูุงุณุชุฌุงุจุฉ ุงููุชููุนุฉ:

```json
{
  "job_id": "abc12345-...",
  "status": "processing",
  "message": "Merge job started"
}
```

---

## ุชุฑุชูุจ ุงูุชูููุฐ

| ุงูุฃููููุฉ | ุงููููุฉ |
|----------|--------|
| 1 | ุฅุตูุงุญ corsHeaders ูุฅุถุงูุฉ X-API-Key |
| 2 | ุฅูุดุงุก google-auth Edge Function |
| 3 | ุฅูุดุงุก ุตูุญุฉ AuthCallback |
| 4 | ุชุญุฏูุซ OAuthSettings ูุน Google OAuth |
| 5 | ุฅูุดุงุก verify-tokens Edge Function |
| 6 | ุชุญุฏูุซ ุฌููุน ุงูุฅุนุฏุงุฏุงุช ูุนุฑุถ ูุนูููุงุช ุงูุญุณุงุจุงุช |
| 7 | ุฅูุดุงุก test-publish Edge Function |
| 8 | ุชุญุฏูุซ publish-video ูุงุณุชุฎุฏุงู oauth_tokens |
| 9 | ุชุญุฏูุซ ai-generate ูููุดุฑ ุงูุชููุงุฆู |
| 10 | ุฅูุดุงุก ุฃุฏุงุฉ ุงุฎุชุจุงุฑ API ูู ุงููุงุฌูุฉ |

